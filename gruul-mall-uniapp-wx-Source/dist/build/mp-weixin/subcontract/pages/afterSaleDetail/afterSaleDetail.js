(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subcontract/pages/afterSaleDetail/afterSaleDetail"],{"0e9f":function(t,e,n){"use strict";var o=function(t){t.options.wxsCallMethods||(t.options.wxsCallMethods=[])};e["a"]=o},"159c":function(t,e,n){"use strict";var o=n("7c1e"),r=n.n(o);r.a},"33e3":function(t,e,n){"use strict";(function(t){function o(t){return o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n("9ab4"),i=n("60a3"),a=n("1b35"),u=n("0364");function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function f(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function d(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}function p(t,e){return p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},p(t,e)}function y(t){var e=g();return function(){var n,o=b(t);if(e){var r=b(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h(this,n)}}function h(t,e){return!e||"object"!==o(e)&&"function"!==typeof e?v(t):e}function v(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function g(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}var m=function(){n.e("components/goods/goods").then(function(){return resolve(n("58b2"))}.bind(null,n)).catch(n.oe)},O=n("166e"),S=function(e){d(o,e);var n=y(o);function o(){var t;return l(this,o),t=n.apply(this,arguments),t.detail={},t.goods={},t.sheetVisible=!1,t.address={},t.options={},t}return f(o,[{key:"templateName",get:function(){return this.detail.type+"-"+this.detail.status}},{key:"onLoad",value:function(t){var e=this;this.options=t;var n=t.afsid,o=void 0===n?"301":n;this.$STORE.setStore.isReady&&this.getAfterDetail(o),this.$Pubsub.on("app-launch",(function(){e.getAfterDetail(o)}))}},{key:"onShow",value:function(){this.getAfterDetail(this.options.afsid)}},{key:"goGoods",value:function(e){var n=e.target.dataset,o=n.id,r=n.img;t.navigateTo({url:"/subcontract/pages/detail/detail?id=".concat(o,"&img=").concat(r)})}},{key:"handleUserReturn",value:function(){t.navigateTo({url:"/subcontract/pages/afterSaleReturn/afterSaleReturn?afsId=".concat(this.detail.id,"&goods=").concat(JSON.stringify(this.detail.item))})}},{key:"getdeliveryInfo",value:function(t){var e=this;t&&!Object.values(t).filter((function(t){return!t})).length&&(0,u.getdeliveryInfo)({tracesId:t.tracesId,companyName:t.companyName,deliveryCode:t.deliveryCode}).then((function(t){var n=JSON.parse(t)||[];e.setData(c({},"detail.steps",n.map((function(t){var e=t.context,n=t.time;return{text:e,desc:n}})).reverse()))})).catch((function(){return e.setData(c({},"detail.steps",[]))}))}},{key:"getAfterDetail",value:function(t){var e=this;(0,a.getAfterDetail)(t).then((function(t){t.deadline&&(t.deadline=t.deadline.replace(/-/g,"/")),t.images&&(t.images=t.images.split(",")),e.getReturnAddress(t.originalOrder),e.setData({detail:t,goods:t.item},(function(){var n=t.originalOrder.orderDelivery;e.getdeliveryInfo({tracesId:n.deliverySn,companyName:n.deliveryCompany,deliveryCode:n.deliveryCode}),e.getApplyNum()}))})).catch((function(){e.$Popup.toast("售后详情请求失败")}))}},{key:"getReturnAddress",value:function(t){var e=this;"LOGISTICS"===t.orderDelivery.deliveryType&&t.id&&(0,a.getReturnAddress)(t.id).then((function(t){e.setData(c({},"detail.address",t))})).catch((function(){e.$Popup.toast("退货地址获取失败")}))}},{key:"getApplyNum",value:function(){var t=this;(0,a.getApplyNumber)(this.detail.item.orderId).then((function(e){var n=e.number;t.setData(c({},"detail.applyNum",n))})).catch((function(){t.$Popup.toast("申请次数获取失败")}))}},{key:"onSelect",value:function(t){var e=t.detail,n=e.name,o=e.id;this.userApply(n,o)}},{key:"onClose",value:function(){this.toggleSheetVisible()}},{key:"toggleSheetVisible",value:function(){this.setData({sheetVisible:!this.sheetVisible})}},{key:"handleCancel",value:function(){var t=this;this.$Popup.modal({title:"提示",content:"确认撤销此次售后申请吗？"}).then((function(){(0,a.cancel)(t.detail.id).then((function(){t.$Popup.toast("撤销成功"),t.getAfterDetail(t.options.afsid)})).catch((function(){t.$Popup.toast("撤销失败")}))})).catch((function(){return null}))}},{key:"objectToQueryStr",value:function(t){var e="";return Object.keys(t).map((function(n,o){return e+="".concat(o?"&":"").concat(n,"=").concat(t[n])})),e}},{key:"userApply",value:function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.detail,i=r.item,a=r.originalOrder,u=a.orderItemList.find((function(t){return t.productSkuId===i.productSkuId})),c=this.detail.originalOrder.orderItemList.filter((function(t){return O.userApplyVisible(t.afs)||O.isRevoke(t.afs)})),l=this.detail.originalOrder.privileges&&this.detail.originalOrder.privileges.includes("2");if(u){var s=this.objectToQueryStr({title:e,type:n,orderId:u.orderId,productSkuId:u.productSkuId,goods:encodeURIComponent(JSON.stringify(i)),productQuantity:u.productQuantity,refundAmount:u.realAmount+(c.length>1&&l?0:this.detail.originalOrder.freightAmount),userType:"MALL",hasPicked:o});t.navigateTo({url:"/subcontract/pages/applyAfterSale/applyAfterSale?".concat(s)})}}},{key:"handleApplyAgain",value:function(t){var e=t.currentTarget.dataset.actions;return this.detail.applyNum>=3?this.$Popup.toast("已超过最大申请次数"):1===e.length?this.userApply("退款","REFUND",1):void this.toggleSheetVisible()}},{key:"pushHome",value:function(){this.$STORE.setStore.backHome()}},{key:"showImage",value:function(e){t.previewImage({current:e,urls:this.detail.images})}}]),o}(i.Vue);S=(0,r.__decorate)([(0,i.Component)({components:{GoodsItem:m}})],S);var k=S;e.default=k}).call(this,n("543d")["default"])},"569b":function(t,e,n){"use strict";n.r(e);var o=n("33e3"),r=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=r.a},"6ba3":function(t,e,n){"use strict";n.r(e);var o=n("8d98"),r=n("569b");for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);n("159c");var a,u=n("f0c5"),c=n("bad0"),l=n("0e9f"),s=Object(u["a"])(r["default"],o["b"],o["c"],!1,null,"149a57a6",null,!1,o["a"],a);"function"===typeof c["a"]&&Object(c["a"])(s),"function"===typeof l["a"]&&Object(l["a"])(s),e["default"]=s.exports},"7c1e":function(t,e,n){},"8d98":function(t,e,n){"use strict";var o;n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));var r=function(){var t=this,e=t.$createElement;t._self._c},i=[]},bad0:function(t,e,n){"use strict";var o=function(t){t.options.wxsCallMethods||(t.options.wxsCallMethods=[])};e["a"]=o},fb67:function(t,e,n){"use strict";(function(t){n("6cdc");var e=o(n("6ba3"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])}},[["fb67","common/runtime","common/vendor"]]]);