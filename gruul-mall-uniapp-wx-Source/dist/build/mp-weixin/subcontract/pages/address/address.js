(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subcontract/pages/address/address"],{2744:function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return s})),r.d(e,"a",(function(){return n}));var n={mIcon:function(){return r.e("components/m-icon/m-icon").then(r.bind(null,"c7bc"))}},a=function(){var t=this,e=t.$createElement;t._self._c},s=[]},"29e4":function(t,e,r){"use strict";var n=r("abb9"),a=r.n(n);a.a},"3bc5":function(t,e,r){"use strict";r.r(e);var n=r("2744"),a=r("7688");for(var s in a)["default"].indexOf(s)<0&&function(t){r.d(e,t,(function(){return a[t]}))}(s);r("29e4");var o,i=r("f0c5"),u=Object(i["a"])(a["default"],n["b"],n["c"],!1,null,"a70fa076",null,!1,n["a"],o);e["default"]=u.exports},"743f5":function(t,e,r){"use strict";(function(t){r("6cdc");var e=n(r("3bc5"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,r("543d")["createPage"])},7688:function(t,e,r){"use strict";r.r(e);var n=r("8fac"),a=r.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){r.d(e,t,(function(){return n[t]}))}(s);e["default"]=a.a},"8fac":function(t,e,r){"use strict";(function(t){function n(t){return n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=d(r("a34a")),s=r("9ab4"),o=r("60a3"),i=d(r("7297")),u=d(r("ff1b")),c=r("7fa4");function d(t){return t&&t.__esModule?t:{default:t}}function f(t,e,r,n,a,s,o){try{var i=t[s](o),u=i.value}catch(c){return void r(c)}i.done?e(u):Promise.resolve(u).then(n,a)}function l(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var s=t.apply(e,r);function o(t){f(s,n,a,o,i,"next",t)}function i(t){f(s,n,a,o,i,"throw",t)}o(void 0)}))}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function m(t,e,r){return e&&p(t.prototype,e),r&&p(t,r),t}function v(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}function y(t,e){return y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},y(t,e)}function b(t){var e=F();return function(){var r,n=L(t);if(e){var a=L(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return w(this,r)}}function w(t,e){return!e||"object"!==n(e)&&"function"!==typeof e?g(t):e}function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function F(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function L(t){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},L(t)}var k=function(){r.e("components/m-icon/m-icon").then(function(){return resolve(r("c7bc"))}.bind(null,r)).catch(r.oe)},x=function(e){v(n,e);var r=b(n);function n(){var t;return h(this,n),t=r.apply(this,arguments),t.addressList=[],t.addressForm={id:0,city:"",county:"",detailInfo:"",location:"",phone:"",province:"",userName:"",defaultStatus:"",postCode:""},t.areaList={province_list:{}},t.authAddressStatus="首次授权",t.defaultArea="",t.authLocationStatus="首次授权",t.redirect="",t}return m(n,[{key:"onLoad",value:function(){var t=l(a.default.mark((function t(e){var r,n,s;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.redirect,this.redirect=r,this.getDataList(),t.next=5,(0,c.getArea)({id:"",type:1});case 5:n=t.sent,s={},n.forEach((function(t){s[t.value]=t.label})),this.areaList.province_list=s,this.getPermission();case 10:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"onShow",value:function(){this.getDataList()}},{key:"chooseBack",value:function(e){var r=e.currentTarget.dataset.item;if(this.redirect){var n=getCurrentPages(),a=n[n.length-2];a.$vm.address=r,t.navigateBack({delta:1})}}},{key:"getDataList",value:function(){var t=l(a.default.mark((function t(){var e;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,c.getAddressList)({type:1});case 2:e=t.sent,this.addressList=e;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"onCheckBoxChange",value:function(){var t=l(a.default.mark((function t(e){var r,n,s;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=e.currentTarget.dataset.item,n=this.addressForm,s=this.addressList,n.id=r.id,n.defaultStatus=e.detail?1:0,n.phone=r.phone,n.location=r.location,n.city=r.city,n.county=r.county,n.detailInfo=r.detailInfo,n.userName=r.userName,n.province=r.province,n.postCode=r.postCode,s.forEach((function(t){t.id===n.id&&(t.defaultStatus=e.detail?1:0)})),this.addressForm=n,this.addressList=s,this.addOrUpdateAddress("直接修改");case 17:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"addManualLocation",value:function(){var e=l(a.default.mark((function e(){var r,n=this;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=this.verifyLocationEnabled(),r){e.next=3;break}return e.abrupt("return");case 3:t.showLoading({title:"",mask:!0}),this.addressForm.id=0,t.getLocation({type:"wgs84",success:function(){var e=l(a.default.mark((function e(r){var s,o,i,u;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=r.latitude,o=r.longitude,i="".concat(o,", ").concat(s),e.next=5,n.setAddressByLatAndLon(i);case 5:u={id:0,city:n.addressForm.city,county:n.addressForm.county,detailInfo:"",location:"",phone:"",province:n.addressForm.province,userName:"",defaultStatus:"",postCode:""},n.addressForm=u,t.hideLoading(),t.navigateTo({url:"/subcontract/pages/addAddress/addAddress?addressForm="+JSON.stringify(n.addressForm)});case 9:case"end":return e.stop()}}),e)})));function r(t){return e.apply(this,arguments)}return r}(),fail:function(){t.hideLoading(),n.authLocationStatus="未授权"}});case 6:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"addManualOpenLocation",value:function(){var e=l(a.default.mark((function e(){var r,n=this;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=this.verifyLocationEnabled(),r){e.next=3;break}return e.abrupt("return");case 3:t.showLoading({title:"",mask:!0}),this.authLocationStatus="已授权",t.getLocation({type:"wgs84",success:function(){var e=l(a.default.mark((function e(r){var s,o,i,u;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=r.latitude,o=r.longitude,i="".concat(o,", ").concat(s),e.next=5,n.setAddressByLatAndLon(i);case 5:u={id:0,city:n.addressForm.city,county:n.addressForm.county,detailInfo:"",location:"",phone:"",province:n.addressForm.province,userName:"",defaultStatus:"",postCode:""},n.addressForm=u,t.hideLoading(),t.navigateTo({url:"/subcontract/pages/addAddress/addAddress?addressForm="+JSON.stringify(n.addressForm)});case 9:case"end":return e.stop()}}),e)})));function r(t){return e.apply(this,arguments)}return r}(),fail:function(){t.hideLoading(),n.authLocationStatus="未授权"}});case 6:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"setAddressByLatAndLon",value:function(){var t=l(a.default.mark((function t(e){var r;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,c.analysisLatAndLon)({site:e});case 2:r=t.sent,this.addressForm.province=r.province.label,this.addressForm.city=r.city?r.city.label:"",this.addressForm.county=r.district?r.district.label:"",this.addressForm.postCode=r.adcode?r.adcode:"";case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"addWxLocation",value:function(){var e=l(a.default.mark((function e(){var r,n=this;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=this.verifyLocationEnabled(),r){e.next=3;break}return e.abrupt("return");case 3:"首次授权"===this.authAddressStatus&&t.chooseAddress({success:function(t){n.addressForm.id=0,n.addressForm.phone=t.telNumber,n.addressForm.city=t.cityName,n.addressForm.county=t.countyName,n.addressForm.detailInfo=t.detailInfo,n.addressForm.userName=t.userName,n.addressForm.province=t.provinceName,n.authAddressStatus="已授权",n.addOrUpdateAddress()},fail:function(){n.authAddressStatus="未授权"}}),"已授权"===this.authAddressStatus&&t.chooseAddress({success:function(t){n.addressForm.id=0,n.addressForm.phone=t.telNumber,n.addressForm.city=t.cityName,n.addressForm.county=t.countyName,n.addressForm.detailInfo=t.detailInfo,n.addressForm.userName=t.userName,n.addressForm.province=t.provinceName,n.addOrUpdateAddress()}});case 5:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"addWxOpenLocation",value:function(){var e=l(a.default.mark((function e(){var r,n=this;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=this.verifyLocationEnabled(),r){e.next=3;break}return e.abrupt("return");case 3:this.authAddressStatus="已授权",t.chooseAddress({success:function(t){n.addressForm.id=0,n.addressForm.phone=t.telNumber,n.addressForm.city=t.cityName,n.addressForm.county=t.countyName,n.addressForm.detailInfo=t.detailInfo,n.addressForm.userName=t.userName,n.addressForm.province=t.provinceName,n.addOrUpdateAddress()},fail:function(){n.authAddressStatus="未授权"}});case 5:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"addOrUpdateAddress",value:function(){var e=l(a.default.mark((function e(r){return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.addressForm.userName){e.next=3;break}return t.showToast({title:"请输入收货人姓名",icon:"none"}),e.abrupt("return");case 3:if(this.addressForm.phone&&this.isPhone(this.addressForm.phone)){e.next=6;break}return t.showToast({title:"手机号不正确",icon:"none"}),e.abrupt("return");case 6:if(this.addressForm.province&&this.addressForm.city&&this.addressForm.county){e.next=9;break}return t.showToast({title:"存在空的地址信息",icon:"none"}),e.abrupt("return");case 9:if(0===this.addressForm.id){e.next=25;break}if(e.prev=10,"直接修改"===r){e.next=14;break}return e.next=14,this.getLatAndLonByAddress();case 14:return e.next=16,(0,c.updateAddress)(JSON.stringify(this.addressForm));case 16:t.showToast({title:"操作成功",icon:"none"}),this.getDataList(),e.next=23;break;case 20:e.prev=20,e.t0=e["catch"](10),"请勿添加相同地址"===e.t0?t.showToast({title:"修改地址成功",icon:"none"}):t.showToast({title:e.t0,icon:"none"});case 23:e.next=37;break;case 25:return e.prev=25,e.next=28,this.getLatAndLonByAddress();case 28:return e.next=30,(0,c.addAddress)(JSON.stringify(this.addressForm));case 30:t.showToast({title:"添加地址成功",icon:"none"}),this.getDataList(),e.next=37;break;case 34:e.prev=34,e.t1=e["catch"](25),t.showToast({title:e.t1,icon:"none"});case 37:case"end":return e.stop()}}),e,this,[[10,20],[25,34]])})));function r(t){return e.apply(this,arguments)}return r}()},{key:"getLatAndLonByAddress",value:function(){var t=l(a.default.mark((function t(){var e,r,n,s,o,i,u;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.addressForm,r=e.province,n=e.city,s=e.county,o=e.detailInfo,i=r+n+s+o,t.next=4,(0,c.getLatAndLon)({site:i});case 4:u=t.sent,this.addressForm.location=u.location,this.addressForm.postCode=u.andlongitudeVo.adcode;case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"deleteAddress",value:function(t){var e=this;i.default.confirm({message:"确定删除该地址",className:"wxDialog"}).then(l(a.default.mark((function r(){return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,(0,c.deleteAddress)(t.currentTarget.dataset.id);case 2:u.default.success("删除成功"),e.getDataList();case 4:case"end":return r.stop()}}),r)})))).catch((function(){e.getDataList()}))}},{key:"getPermission",value:function(){var e=l(a.default.mark((function e(){var r;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=this,t.getSetting({success:function(t){var e=t.authSetting;void 0===e["scope.userLocation"]?r.authLocationStatus="首次授权":e["scope.userLocation"]?r.authLocationStatus="已授权":r.authLocationStatus="未授权",void 0===e["scope.address"]?r.authAddressStatus="首次授权":e["scope.address"]?r.authAddressStatus="已授权":r.authAddressStatus="未授权"}});case 2:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"isPhone",value:function(t){return!(!/^1[0-9]\d{9}$/.test(t)||!t.match(/^\d{11}$/))}},{key:"handleItemClick",value:function(e){var r=e.currentTarget.dataset.address;this.addressForm.id=r.id,this.addressForm.defaultStatus=r.isDefault,this.addressForm.phone=r.phone,this.addressForm.city=r.city,this.addressForm.county=r.county,this.addressForm.detailInfo=r.detailInfo,this.addressForm.userName=r.userName,this.addressForm.province=r.province,this.addressForm.postCode=r.postCode,t.navigateTo({url:"/subcontract/pages/addAddress/addAddress?addressForm="+JSON.stringify(this.addressForm)})}},{key:"verifyLocationEnabled",value:function(){var e=t.getSystemInfoSync(),r=e.locationAuthorized;if(r)return!0;i.default.alert({message:"无法获取你的位置信息。请到手机系统的[设置]->[隐私]->[定位服务]中打开定位，并允许微信使用定位服务。"}).then((function(){return!1}))}}]),n}(o.Vue);x=(0,s.__decorate)([(0,o.Component)({components:{mIcon:k}})],x);var A=x;e.default=A}).call(this,r("543d")["default"])},abb9:function(t,e,r){}},[["743f5","common/runtime","common/vendor"]]]);