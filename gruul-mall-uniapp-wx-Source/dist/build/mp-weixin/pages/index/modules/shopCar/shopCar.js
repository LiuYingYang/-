(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/modules/shopCar/shopCar"],{"2a4c":function(t,e,i){"use strict";i.r(e);var n=i("be70"),o=i.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=o.a},"5c4d":function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return n}));var n={goods:function(){return i.e("components/goods/goods").then(i.bind(null,"58b2"))},stepper:function(){return i.e("components/stepper/stepper").then(i.bind(null,"dfe3"))}},o=function(){var t=this,e=t.$createElement;t._self._c},s=[]},"5fdd":function(t,e,i){"use strict";i.r(e);var n=i("5c4d"),o=i("2a4c");for(var s in o)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(s);i("c7bf");var r,c=i("f0c5"),u=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,"1607b376",null,!1,n["a"],r);e["default"]=u.exports},"8dd6":function(t,e,i){},be70:function(t,e,i){"use strict";(function(t){function n(t){return n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=h(i("a34a")),s=i("9ab4"),r=i("60a3"),c=i("7459"),u=i("771b"),a=h(i("7297"));function h(t){return t&&t.__esModule?t:{default:t}}function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){p(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function p(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function d(t,e,i,n,o,s,r){try{var c=t[s](r),u=c.value}catch(a){return void i(a)}c.done?e(u):Promise.resolve(u).then(n,o)}function g(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var s=t.apply(e,i);function r(t){d(s,n,o,r,c,"next",t)}function c(t){d(s,n,o,r,c,"throw",t)}r(void 0)}))}}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function y(t,e,i){return e&&v(t.prototype,e),i&&v(t,i),t}function m(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b(t,e)}function b(t,e){return b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},b(t,e)}function C(t){var e=P();return function(){var i,n=w(t);if(e){var o=w(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return S(this,i)}}function S(t,e){return!e||"object"!==n(e)&&"function"!==typeof e?L(t):e}function L(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function P(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function w(t){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},w(t)}var O=function(){i.e("pages/index/modules/shopCar/components/goods/goods").then(function(){return resolve(i("100a"))}.bind(null,i)).catch(i.oe)},T=function(){i.e("pages/index/modules/shopCar/components/unusable/unusable").then(function(){return resolve(i("1256"))}.bind(null,i)).catch(i.oe)},E=function(){i.e("pages/index/modules/shopCar/components/pop/sku/sku").then(function(){return resolve(i("9e13"))}.bind(null,i)).catch(i.oe)},D=function(){i.e("components/stepper/stepper").then(function(){return resolve(i("dfe3"))}.bind(null,i)).catch(i.oe)},I=function(){i.e("components/m-icon/m-icon").then(function(){return resolve(i("c7bc"))}.bind(null,i)).catch(i.oe)},j=function(e){m(n,e);var i=C(n);function n(){var t;return k(this,n),t=i.apply(this,arguments),t.navigationBarHeight="",t.shopCarList=[],t.temShopList=[],t.shopType=!0,t.shopLoseCarList=[],t.editFlag=!1,t.selectAll=!1,t.selectList=[],t.showType=!1,t.goodDetail={},t.norms={},t.allPrice="0.00",t.isPhone11=46,t.isAddCollect=!1,t.canClick=!1,t.pageHeight=0,t}return y(n,[{key:"created",value:function(){this.getList(),t.setNavigationBarTitle({title:"购物车"})}},{key:"addCollect",value:function(){var e=this,i=this.getSelectList();if(0!==i.length){var n=[];i.forEach((function(t){t.skuStocks.forEach((function(e){e.id===t.skuId&&(t.originalPrice=e.originalPrice)})),n.push({originalPrice:t.originalPrice,productId:t.productId,productName:t.productName,productPic:t.pic,productPrice:t.actPrice,status:t.status})})),(0,u.userAddCollect)(n).then((function(){t.showToast({title:"收藏成功",icon:"none"}),e.isAddCollect=!0,e.deleteButton()})).catch((function(t){console.log(t)}))}else t.showToast({title:"请选择要加入商品",icon:"none"})}},{key:"submit",value:function(){var e=this.shopCarList.filter((function(t){return t.isCheck})).map((function(t){return{activityId:t.activityId,activityProductId:t.activityProductId,dominoState:t.dominoState,number:t.goodsNumber,skuId:t.skuId}}));e.length?t.navigateTo({url:"/modules/pages/submit/submit?items=".concat(encodeURIComponent(JSON.stringify(e)))}):t.showToast({title:"请选择商品",icon:"none"})}},{key:"getList",value:function(){var e=g(o.default.mark((function e(){var i,n,s,r,u,a,h,l,f,p,d=this;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$emit("shopCarChange",{},{}),i="",n=this.isPhone11,s=!1,r=t.getSystemInfoSync(),t.getSystemInfo({success:function(t){i=t.model,"iPhone XS<iPhone11,2>"===i&&(n=80),"iPhone 11<iPhone12,1>"!==i&&"iPhone XR<iPhone11,8>"!==i||(n=86),"iPhone X (GSM+CDMA)<iPhone10,3>"===i&&(n=82)}}),e.next=8,(0,c.getCarsList)();case 8:if(u=e.sent,a=u,h=[],l=[],f=!1,a){e.next=23;break}return this.shopCarList=[].concat(h),this.temShopList=[].concat(h),this.shopLoseCarList=l,this.allPrice="0.00",this.isPhone11="iPhone XS<iPhone11,2>"===i||"iPhone 11<iPhone12,1>"===i||"iPhone XR<iPhone11,8>"===i||"iPhone X (GSM+CDMA)<iPhone10,3>"===i,this.shopType=!0,this.selectAll=!1,this.pageHeight=r.windowHeight,e.abrupt("return");case 23:p=[],a.forEach((function(t){p.push(t)})),f||(a=p),a.forEach((function(t,e){t.isCheck=!1,t.itemIndex=e,t.skuList=[],t=d.dealPrice(t);var i=t.skuStocks.every((function(t){return 0===t.stock}));t.status=i?2:t.status,1===t.deleted&&(t.status=2),t.skuStocks.forEach((function(e){t.skuList=t.skuList?t.skuList:[],t.skuList.push(e.id),e.price=0===e.price?e.originalPrice:e.price,t.skuId===e.id&&(t.price=e.price,t.perLimit=e.perLimit,t.checkStock=e.stock,t.pic=t.skuStocks.length>1?e.pic:t.pic)})),t.skuList=t.skuList?t.skuList:[],t.status=-1===t.skuList.indexOf(t.skuId)?0:t.status,t.activityEndTime&&(t.status="1"===t.activityStatus||"0"===t.activityStatus?1:0),1===t.status?(h.push(t),h.length>0&&(h.forEach((function(t){t.isCheck=Boolean(t.selectStatus)})),s=h.every((function(t){return!0===t.isCheck})))):l.push(t)})),this.shopCarList=h,this.temShopList=JSON.parse(JSON.stringify(h)),this.shopLoseCarList=l,this.allPrice="0.00",this.isPhone11=n,this.shopType=f,this.selectAll=s,this.pageHeight=r.windowHeight,this.dealSelct(),this.getAllPrice();case 37:case"end":return e.stop()}}),e,this)})));function i(){return e.apply(this,arguments)}return i}()},{key:"dealSelct",value:function(){var t=this.getSelectList();this.selectList=t}},{key:"dealPrice",value:function(t){return t.skuStocks.forEach((function(e,i){e.id===t.skuId&&(t.actPrice=0===t.skuStocks[i].price?t.skuStocks[i].originalPrice:t.skuStocks[i].price,t.skuName=t.skuStocks[i].specs)})),t}},{key:"onChange",value:function(e){var i=this;if(!this.canClick){var n=[],o=e.currentTarget.dataset.index,s=this.shopCarList,r=[],u=s[o];u.isCheck=!u.isCheck,n.push(u.skuId);var a=u.selectStatus;this.canClick=!0,t.showLoading({title:"加载中"}),(0,c.changeType)(1===a?0:1,n).then((function(){setTimeout((function(){t.hideLoading(),i.canClick=!1}),100)}));var h=s.every((function(t){return t.isCheck}));s.forEach((function(t){t.isCheck&&r.push(t)})),this.shopCarList[o].isCheck=u.isCheck,this.selectAll=h,this.selectList=r,this.getAllPrice()}}},{key:"getSku",value:function(t){var e=this;this.$STORE.setStore.setTabVisible(!1),this.$STORE.setStore.setFormShopCar(!0);var i=t.skuId,n={};this.shopCarList.forEach((function(t){t.skuId===i&&(e.goodDetail=t)})),this.goodDetail.skuStocks.forEach((function(t){t.getType=!1,t.maxNum=t.perLimit<t.stock?t.perLimit:t.stock,t.id===i&&(t.getType=!0,n=t,"0.00"!==String(e.goodDetail.actPrice)?n.price=e.goodDetail.actPrice?e.goodDetail.actPrice:e.goodDetail.price?e.goodDetail.price:"0.00":n.price=e.goodDetail.price?e.goodDetail.price:"0.00")})),this.showType=!0,this.goodDetail,this.norms=n}},{key:"closeSku",value:function(){this.showType=!1}},{key:"checkNorms",value:function(t){this.goodDetail.skuStocks.forEach((function(e){e.getType=!1,e.id===t.id&&(e.getType=!0)})),this.setData({norms:t,goodDetail:Object.assign({},this.goodDetail)})}},{key:"delGood",value:function(){var e=g(o.default.mark((function e(i){var n,s,r=this;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=i,s=[],s.push(this.shopCarList[n]),a.default.confirm({title:"删除商品",message:"确认删除此商品吗，删除后可再次添加购物车"}).then((function(){(0,c.delCarsList)(s).then((function(){t.showToast({title:"删除成功",icon:"none"})})).then((function(){r.getList()}))}));case 4:case"end":return e.stop()}}),e,this)})));function i(t){return e.apply(this,arguments)}return i}()},{key:"eidtList",value:function(){this.editFlag=!this.editFlag}},{key:"changeNum",value:function(e){if(100!==e.code)if(200!==e.code){var i=e.index,n=this.shopCarList[i],o=this.temShopList[i];n.goodsNumber=e.num,this.editShopCar(n,o,0),n.isCheck&&this.getAllPrice(),this.shopCarList[i].goodsNumber=n.goodsNumber,this.$emit("shopCarChange",{})}else t.showToast({title:"库存不足",icon:"none"});else t.showToast({title:"已达限购数量",icon:"none"})}},{key:"addShopCar",value:function(t){var e=this,i=t.goodDetail,n={};this.shopCarList.forEach((function(t,o){t.itemIndex===i.itemIndex&&(n=e.temShopList[o])})),this.editShopCar(i,n,1)}},{key:"editShopCar",value:function(e,i,n){var o=this,s={oldApiShoppingCartDto:f({},i),newApiShoppingCartDto:f({},e)};(0,c.editCarsList)(s).then((function(){o.showType=!1,o.$STORE.setStore.setTabVisible(!0),o.$emit("shopCarChange"),n&&o.getList()})).catch((function(e){t.showToast({icon:"none",title:"".concat(e)})}))}},{key:"emptyUseless",value:function(){var e=this,i=[];this.shopLoseCarList.forEach((function(t){i.push(t.skuId)})),a.default.confirm({title:"清空商品",message:"确认清空失效商品吗"}).then((function(){(0,c.emptyCarsList)(i).then((function(){t.showToast({icon:"none",title:"清空成功"}),e.getList()}))})).catch((function(t){console.log(t)}))}},{key:"eidtFinish",value:function(){this.editFlag=!1}},{key:"chooseAll",value:function(){var t=this.shopCarList,e=[],i=this.selectAll;0!==this.shopCarList.length&&(i=!i,t.forEach((function(t){t.isCheck=i,t.isCheck&&e.push(t)})),this.shopCarList=t,this.selectAll=i,this.selectList=e,this.getAllPrice())}},{key:"deleteButton",value:function(){var e=this,i=this.getSelectList();0!==i.length?this.isAddCollect?(0,c.delCarsList)(i).then((function(){e.isAddCollect=!1,e.getList()})):a.default.confirm({title:"删除商品",message:"确认删除选中商品吗，删除后可再次添加购物车"}).then((function(){(0,c.delCarsList)(i).then((function(){t.showToast({icon:"none",title:"删除成功"}),e.getList(),e.$STORE.userStore.getShopCarNum()}))})):t.showToast({title:"请先选择要删除商品",icon:"none"})}},{key:"getAllPrice",value:function(){var t=this.shopCarList.reduce((function(t,e){var i=e.isCheck?e.price*e.goodsNumber:0;return t+i}),0);this.allPrice=t.toFixed(2)}},{key:"getSelectList",value:function(){return this.shopCarList.filter((function(t){return t.isCheck}))}},{key:"gotoHome",value:function(){this.$STORE.setStore.backHome()}}]),n}(r.Vue);(0,s.__decorate)([(0,r.Prop)()],j.prototype,"navigationBarHeight",void 0),j=(0,s.__decorate)([(0,r.Component)({components:{goods:O,unusable:T,sku:E,stepper:D,mIcon:I}})],j);var x=j;e.default=x}).call(this,i("543d")["default"])},c7bf:function(t,e,i){"use strict";var n=i("8dd6"),o=i.n(n);o.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'pages/index/modules/shopCar/shopCar-create-component',
    {
        'pages/index/modules/shopCar/shopCar-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("5fdd"))
        })
    },
    [['pages/index/modules/shopCar/shopCar-create-component']]
]);
