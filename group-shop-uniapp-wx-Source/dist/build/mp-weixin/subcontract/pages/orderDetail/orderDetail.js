(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subcontract/pages/orderDetail/orderDetail"],{"3d56":function(e,t,r){"use strict";var n=r("9b42"),o=r.n(n);o.a},"44f6":function(e,t,r){"use strict";r.r(t);var n=r("e407"),o=r.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(i);t["default"]=o.a},"7d3a":function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return i})),r.d(t,"a",(function(){return n}));var n={goods:function(){return r.e("components/goods/goods").then(r.bind(null,"58b2"))}},o=function(){var e=this,t=e.$createElement;e._self._c},i=[]},"7ed2":function(e,t,r){"use strict";var n=function(e){e.options.wxsCallMethods||(e.options.wxsCallMethods=[])};t["a"]=n},"990a":function(e,t,r){"use strict";var n=function(e){e.options.wxsCallMethods||(e.options.wxsCallMethods=[])};t["a"]=n},"99f6":function(e,t,r){"use strict";(function(e){r("6cdc");var t=n(r("acac"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])},"9b42":function(e,t,r){},acac:function(e,t,r){"use strict";r.r(t);var n=r("7d3a"),o=r("44f6");for(var i in o)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return o[e]}))}(i);r("3d56");var a,u=r("f0c5"),c=r("7ed2"),s=r("f3eb"),l=r("990a"),f=r("c891"),d=Object(u["a"])(o["default"],n["b"],n["c"],!1,null,"a9ca07ae",null,!1,n["a"],a);"function"===typeof c["a"]&&Object(c["a"])(d),"function"===typeof s["a"]&&Object(s["a"])(d),"function"===typeof l["a"]&&Object(l["a"])(d),"function"===typeof f["a"]&&Object(f["a"])(d),t["default"]=d.exports},c891:function(e,t,r){"use strict";var n=function(e){e.options.wxsCallMethods||(e.options.wxsCallMethods=[])};t["a"]=n},e407:function(e,t,r){"use strict";(function(e){function n(e){return n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r("9ab4"),i=r("60a3"),a=f(r("f93b")),u=r("0364"),c=f(r("ff1b")),s=r("1b35"),l=r("2ef0");function f(e){return e&&e.__esModule?e:{default:e}}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function b(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function g(e,t){return g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},g(e,t)}function O(e){var t=D();return function(){var r,n=I(e);if(t){var o=I(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return S(this,r)}}function S(e,t){return!t||"object"!==n(t)&&"function"!==typeof t?k(e):t}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}var w=r("ce01"),A=r("166e"),T=r("4cf8"),j=r("9fb6"),P=function(t){b(n,t);var r=O(n);function n(){var e;return v(this,n),e=r.apply(this,arguments),e.detail={applyNumHasExceeded:!0},e.userType="user",e.steps=[],e.customForm=[],e.isFirstEnter=!0,e.sheetVisible=!1,e.afterSaleForm={description:"",images:"",productQuantity:"",productSkuId:"",refundAmount:"",templateId:"",type:""},e.afGoods={},e.afs={},e.options={orderId:"",userType:""},e.order=w,e.after=A,e.formHelper=T,e.helper=j,e}return m(n,[{key:"onLoad",value:function(e){var t=this,r=e.orderId;this.setData({options:e}),this.$STORE.setStore.isReady&&this.getOrderDetail(r),this.$Pubsub.on("app-launch",(function(){t.getOrderDetail(r)}))}},{key:"onShow",value:function(){this.isFirstEnter||this.getOrderDetail(this.detail.id)}},{key:"getApplyNum",value:function(){var e=this;(0,s.getApplyNumber)(this.detail.id).then((function(t){var r,n=t.number,o=t.expire,i=[];e.detail.orderItemList.forEach((function(e){var t=n.filter((function(t){return t.productSkuId===e.productSkuId})),r=t.length>0?t[0].userApplyNumber:"0";i.push(p(p({},e),{},{applyNum:r}))})),e.setData((r={},y(r,"detail.orderItemList",i),y(r,"detail.expire",o),r))})).catch((function(){e.$Popup.toast("申请次数获取失败")}))}},{key:"handleApply",value:function(e){var t=e.currentTarget.dataset,r=t.actions,n=t.goods,o=t.afs;return Number(n.applyNum)>3?this.$Popup.toast("超过最大申请数"):(this.setData({afs:o}),1===r.length?(this.setData({afGoods:n}),void this.handleApplyAfter("退款","REFUND",{hasPicked:1})):(this.setData({afGoods:n}),void this.toggleSheetVisible()))}},{key:"goAfterDetail",value:function(t){var r=t.currentTarget.dataset,n=r.afsid,o=r.goods;e.navigateTo({url:"/subcontract/pages/afterSaleDetail/afterSaleDetail?afsid=".concat(n,"&userType=").concat(this.userType,"&goods=").concat(encodeURIComponent(JSON.stringify(o)))})}},{key:"onSelect",value:function(e){var t=e.detail,r=t.name,n=t.id;this.handleApplyAfter(r,n,{})}},{key:"objectToQueryStr",value:function(e){var t="";return Object.keys(e).map((function(r,n){return t+="".concat(n?"&":"").concat(r,"=").concat(e[r])})),t}},{key:"handleApplyAfter",value:function(t,r,n){var o=this.detail,i=o.id,a=o.status,u=this.afGoods,c=this.detail.orderItemList.filter((function(e){return A.userApplyVisible(e.afs)||A.isRevoke(e.afs)})),s=this.detail.privileges&&this.detail.privileges.includes("2"),l=this.objectToQueryStr(p(p({},this.afterSaleForm),{},{title:t,type:r,orderId:i,productSkuId:u.productSkuId,goods:encodeURIComponent(JSON.stringify(u)),productQuantity:u.productQuantity,refundAmount:u.realAmount+(c.length>1&&s?0:this.detail.freightAmount),hasPicked:"WAIT_FOR_PICKUP"===a?1:0,userType:this.userType},n));e.navigateTo({url:"/subcontract/pages/applyAfterSale/applyAfterSale?".concat(l)})}},{key:"onClose",value:function(){this.toggleSheetVisible()}},{key:"toggleSheetVisible",value:function(){this.setData({sheetVisible:!this.sheetVisible})}},{key:"transformFormToData",value:function(e){try{var t=JSON.parse(e);return this.setData({customForm:t}),!0}catch(r){return!1}}},{key:"handleChangeAddress",value:function(t){var r=t.currentTarget.dataset.item;e.navigateTo({url:"/subcontract/pages/updateOrderAddress/updateOrderAddress?form=".concat(JSON.stringify(p(p({},r),{},{orderId:this.detail.id})))})}},{key:"goDeliveryDetail",value:function(){var t={orderItemList:this.detail.orderItemList,orderDelivery:this.detail.orderDelivery};e.navigateTo({url:"/subcontract/pages/deliveryInfo/deliveryInfo?data=".concat(encodeURIComponent(JSON.stringify(t)))})}},{key:"getdeliveryInfo",value:function(e){var t=this,r=e.tracesId,n=e.companyName,o=e.deliveryCode;(0,u.getdeliveryInfo)({tracesId:r,companyName:n,deliveryCode:o}).then((function(e){var r=e?JSON.parse(e):[];t.setData({steps:r})})).then((function(){return null}))}},{key:"handleSeePhoto",value:function(t){var r=t.currentTarget.dataset.item;e.previewImage({current:r.value,urls:[r.value]})}},{key:"callbackAction",value:function(){this.getOrderDetail(this.options.orderId||this.detail.id)}},{key:"getOrderDetail",value:function(e){var t=this;(0,u.getOrderDetail)(e).then((function(e){t.setLocalFreightAmount(e),e=t.setCountdown(e),e=t.setAfsData(e),t.setData({detail:e,isFirstEnter:!1,userType:e.type},(function(){return t.getApplyNum()})),e.orderDelivery&&t.getdeliveryInfo({tracesId:e.orderDelivery.deliverySn,companyName:e.orderDelivery.deliveryCompany,deliveryCode:e.orderDelivery.deliveryCode}),t.transformFormToData(e.customForm)})).catch((function(){(0,c.default)({message:"详情获取失败"})}))}},{key:"setAfsData",value:function(e){var t=this,r=!1;return e.orderItemList&&e.orderItemList.map((function(e){e.afs&&(r||(r=t.receiptDisabled(e.afs)))})),e.rBtnStatus=r,e}},{key:"setLocalFreightAmount",value:function(e){e.freightAmountstr=e.privileges&&e.privileges.includes("2")?"免配送费":"￥"+e.freightAmount}},{key:"setCountdown",value:function(e){return e.expireTime&&!(0,l.isNumber)(e.expireTime)&&(e.expireTime=String(+new Date(e.expireTime.replace(/-/gi,"/"))-+new Date)),e}},{key:"goGoods",value:function(t){var r=t.currentTarget.dataset,n=r.id,o=r.img;e.navigateTo({url:"/subcontract/pages/detail/detail?id=".concat(n,"&img=").concat(o)})}},{key:"backHome",value:function(){this.$STORE.setStore.backHome()}},{key:"buyAgain",value:function(){var t=this.detail.orderItemList.map((function(e){return{activityId:e.activityId,activityProductId:e.activityProductId,dominoState:e.dominoState,number:e.productQuantity,skuId:e.productSkuId}}));e.navigateTo({url:"/modules/pages/submit/submit?items=".concat(encodeURIComponent(JSON.stringify(t)))})}}]),n}((0,i.Mixins)(a.default));P=(0,o.__decorate)([(0,i.Component)({})],P);var C=P;t.default=C}).call(this,r("543d")["default"])},f3eb:function(e,t,r){"use strict";var n=function(e){e.options.wxsCallMethods||(e.options.wxsCallMethods=[])};t["a"]=n}},[["99f6","common/runtime","common/vendor"]]]);