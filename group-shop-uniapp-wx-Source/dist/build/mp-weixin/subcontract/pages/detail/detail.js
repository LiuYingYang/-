(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subcontract/pages/detail/detail"],{"174f":function(t,e,o){"use strict";(function(t){o("6cdc");var e=n(o("f4ae"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},"296f":function(t,e,o){"use strict";var n=o("f97b"),i=o.n(n);i.a},"636d":function(t,e,o){"use strict";var n=function(t){t.options.wxsCallMethods||(t.options.wxsCallMethods=[])};e["a"]=n},"902f":function(t,e,o){"use strict";(function(t){function n(t){return n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=h(o("a34a")),a=o("9ab4"),r=o("60a3"),s=h(o("7297")),c=o("771b"),u=o("7459"),l=o("2dc6"),d=h(o("7457"));function h(t){return t&&t.__esModule?t:{default:t}}function f(t){return m(t)||g(t)||v(t)||p()}function p(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function v(t,e){if(t){if("string"===typeof t)return y(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?y(t,e):void 0}}function g(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function m(t){if(Array.isArray(t))return y(t)}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}function b(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function k(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?b(Object(o),!0).forEach((function(e){S(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):b(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function S(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function P(t,e,o,n,i,a,r){try{var s=t[a](r),c=s.value}catch(u){return void o(u)}s.done?e(c):Promise.resolve(c).then(n,i)}function w(t){return function(){var e=this,o=arguments;return new Promise((function(n,i){var a=t.apply(e,o);function r(t){P(a,n,i,r,s,"next",t)}function s(t){P(a,n,i,r,s,"throw",t)}r(void 0)}))}}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function O(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function I(t,e,o){return e&&O(t.prototype,e),o&&O(t,o),t}function T(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&x(t,e)}function x(t,e){return x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},x(t,e)}function C(t){var e=N();return function(){var o,n=R(t);if(e){var i=R(this).constructor;o=Reflect.construct(n,arguments,i)}else o=n.apply(this,arguments);return E(this,o)}}function E(t,e){return!e||"object"!==n(e)&&"function"!==typeof e?j(t):e}function j(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function N(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function R(t){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},R(t)}var A=function(){Promise.all([o.e("common/vendor"),o.e("components/select-norms/selectNorms")]).then(function(){return resolve(o("6f41"))}.bind(null,o)).catch(o.oe)},M=function(){o.e("components/m-icon/m-icon").then(function(){return resolve(o("c7bc"))}.bind(null,o)).catch(o.oe)},L=function(){o.e("components/auth/auth").then(function(){return resolve(o("f72f"))}.bind(null,o)).catch(o.oe)},_=function(){o.e("components/sign/sign").then(function(){return resolve(o("7e38"))}.bind(null,o)).catch(o.oe)},F=function(){o.e("subcontract/pages/detail/cavasCom/canvasCom").then(function(){return resolve(o("c4f1"))}.bind(null,o)).catch(o.oe)},U=function(e){T(a,e);var n=C(a);function a(){var t;return D(this,a),t=n.apply(this,arguments),t.goodDetail={},t.norms={},t.getNorms={},t.buyShow=!1,t.show=!1,t.paraShow=!1,t.timeData={hours:[],seconds:[],minutes:[]},t.state="",t.version="V1.8",t.shareVisible=!1,t.shareImgUrl="",t.imgUrl="",t.cardImgUrl="",t.cardFlag=!0,t.showAll=!1,t.goodId="",t.goodsVideoUrl="",t.videoImg="",t.autoplay=!0,t.current=1,t.countDetail={status:"",toBeginTime:0,toEndTime:0,remainTime:0},t.remainTime=0,t.authType=!1,t.evaluateItem={},t.evaluateOverview=[],t.shopCarNum=0,t.clickShare=!1,t.rebateRatio=0,t.isRebate=!1,t.hideGoodBox=!0,t.feiBox="",t.busPos={},t.finger={},t.hasJoinType=!1,t.APP_VERSION="0.1",t.shopInfo={},t.menu=!1,t.options={},t}return I(a,[{key:"hasOpenEvaluate",get:function(){return this.$STORE.setStore.shopSetting.hasOpenEvaluate}},{key:"longCopy",value:function(){t.setClipboardData({data:this.goodDetail.saleDescribe,success:function(){t.showToast({title:"复制成功"})}})}},{key:"onClose",value:function(){this.show=!1,this.paraShow=!1,this.buyShow=!1,this.shareVisible=!1}},{key:"showShare",value:function(){this.clickShare=!0,this.shareVisible=!0}},{key:"gotoReviews",value:function(){t.navigateTo({url:"/subcontract/pages/reviews/reviews?id=".concat(this.options.id)})}},{key:"checkNorms",value:function(t){this.goodDetail.skuStocks.forEach((function(e){e.getType=!1,e.id===t.id&&(e.getType=!0)})),this.setData({getNorms:t,goodDetail:Object.assign({},this.goodDetail)})}},{key:"gotoCar",value:function(){var e=this.$STORE.setStore.tabBar.list.filter((function(t){return"shopCar"===t.name}));this.$STORE.setStore.setIndexTitle(e[0].text),this.$STORE.setStore.setCurrentPageId(e[0].id),t.reLaunch({url:"/pages/index/index?page=shopCar"})}},{key:"returnHome",value:function(){this.$STORE.setStore.backHome()}},{key:"addShopCar",value:function(){var e=w(i.default.mark((function e(n){var a,r,s,c,l,d,h,f=this;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=n.goodDetail,r=this.goodDetail,!n.index){e.next=5;break}return this.gotoSubmit(a),e.abrupt("return");case 5:if(r.goodsNumber=a.goodsNumber,r.productId=r.id,r.productName=r.name,r.skuId=a.skuId,r.pic=a.pic,r.saleMode=a.saleMode,s={goodsNumber:r.goodsNumber,id:"",saleMode:r.saleMode,productId:r.productId,productName:r.productName,pic:r.pic,productSn:r.productSn,skuId:r.skuId,skuStocks:r.skuStocks,status:r.status,activityStartTime:r.activityStartTime,activityEndTime:r.activityEndTime,activityId:r.activityId,selectStatus:1},this.feiBox=this.goodDetail.pic,this.hideGoodBox){e.next=15;break}return e.abrupt("return");case 15:c={x:0,y:0},l=this.finger,l["y"]<this.busPos["y"]?c["y"]=l["y"]-80:c["y"]=this.busPos["y"]-80,l["x"]<this.busPos["x"]?c["x"]=Math.abs(l["x"]-this.busPos["x"])/2+l["x"]:(c["x"]=this.busPos["x"],l["x"]=this.busPos["x"]),d=o("de3a"),h=d.methods.bezier([l,c,this.busPos],30),(0,u.addCars)(s).then((function(){t.showToast({title:"添加成功",icon:"none"}),f.buyShow=!1,f.startAnimation(h),f.getShopCarNum(),f.$STORE.userStore.getShopCarNum()})).catch((function(e){t.showToast({title:e,icon:"none"})}));case 22:case"end":return e.stop()}}),e,this)})));function n(t){return e.apply(this,arguments)}return n}()},{key:"startAnimation",value:function(t){var e=this,o=0;t.bezierPoints.reverse();this.hideGoodBox=!1;var n=setInterval((function(){o++,o>=28&&(clearInterval(n),e.hideGoodBox=!0)}),20)}},{key:"gotoSubmit",value:function(e){var o=[];o.push({activityId:e.activityId,activityProductId:e.activityProductId,dominoState:e.dominoState,number:e.goodsNumber,skuId:e.skuId}),t.navigateTo({url:"/modules/pages/submit/submit?items=".concat(encodeURIComponent(JSON.stringify(o)))}),this.buyShow=!1}},{key:"onReady",value:function(){var e=this;this.videoContext=t.createVideoContext("myVideo"),t.getSystemInfo({success:function(t){var o=t.windowWidth,n=t.windowHeight;e.busPos["x"]=.5*o,e.busPos["y"]=.9*n,e.finger["x"]=.3*o,e.finger["y"]=.9*n}})}},{key:"onLoad",value:function(t){var e=this;this.options=t,t.img&&(this.goodDetail=k(k({},this.goodDetail),{},{imgUrls:[t.img]})),t.goodTranObj&&this.$STORE.userStore.login(1).then((function(){(0,c.getGoodDetail)(t.id,{}).then((function(o){var n={},i=(t.goodTranObj?t.goodTranObj:"").split(" "),a={shopUserId:i[3],communityId:i[0],groupType:i[1],isGrouper:i[2],goodData:n};t.transData=JSON.stringify(a),e.options=t}))})),this.getData(t),this.$Pubsub.on("app-launch",(function(){e.getData(t)}))}},{key:"onShow",value:function(){var e=this;t.hideHomeButton(),this.shareVisible=!1,this.shopInfo=this.$STORE.shopSetStore.shopInfo,t.onUserCaptureScreen((function(){e.clickShare=!1,e.shareVisible=!0}))}},{key:"getData",value:function(t){this.getGood(t.id)}},{key:"getProductEvaluate",value:function(t){var e=this;(0,c.getProductEvaluate)({productId:t,type:0,size:10,current:1}).then((function(t){e.evaluateItem=t.list[0]})).catch((function(t){e.$Popup.toast(t||"评价列表获取失败")})),(0,c.getProductEvaluateOverview)({productId:t}).then((function(t){e.evaluateOverview=t})).catch((function(t){e.$Popup.toast(t||"评价概况获取失败")}))}},{key:"getGood",value:function(t){var e=this;(0,c.getGoodDetail)(t,{}).then((function(o){o.imgUrls=o.albumPics.split(","),o.serviceIds=o.serviceIds.split(",").join(" · "),o.detail=o.detail.replace(/\<img/g,'<img style="width:100%;height:auto;display:block"'),o.stock=0;var n=o.skuStocks.every((function(t){return 0===t.stock}));if(o.status=n?2:o.status,1===o.skuStocks.list)o.price=o.price.toFixed(2),o.actPrice=o.originalPrice.toFixed(2);else{var i=o.skuStocks.map((function(t){return t.originalPrice}));o.price=Math.min.apply(Math,f(i)).toFixed(2);var a=o.skuStocks.map((function(t){return t.price}));o.actPrice=Math.min.apply(Math,f(a)).toFixed(2),o.leadPrice=Math.max.apply(Math,f(a)).toFixed(2)}o.skuStocks.forEach((function(t){t.price=Number(t.price.toFixed(2)),o.stock+=t.stock,o.sale+=t.sale})),o.savePrice="0.00"===o.actPrice?o.price:o.actPrice,o.savePrice=(Number(o.savePrice)-Number(o.memPrice)).toFixed(2),e.setData({goodDetail:o,goodsVideoUrl:o.videoUrl,goodId:t,clickShare:!0}),e.getCollectType(t)})).then((function(){e.addFooterAdd(),e.getProductEvaluate(t||144),e.getShopCarNum()})).catch((function(t){s.default.alert({title:"提示",message:"".concat(t)}).then((function(){e.$STORE.setStore.backHome()}))}))}},{key:"getCoupon",value:function(t){var e=t.currentTarget.dataset.mode;switch(this.show=!0,e){case"para":this.paraShow=!0;break;default:break}}},{key:"pageLink",value:function(e){var o=e.currentTarget.dataset.link;t.navigateTo({url:"/subcontract/".concat(o)})}},{key:"onSlideChange",value:function(t){this.setData({current:t.detail.current+1}),1!==this.current&&(this.videoContext.pause(),this.setData({autoplay:!0}))}},{key:"bofang",value:function(){this.setData({autoplay:!1})}},{key:"endbofng",value:function(){this.setData({autoplay:!0})}},{key:"getShopCarNum",value:function(){var t=w(i.default.mark((function t(){var e,o,n,a,r;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,u.getCarsList)();case 2:if(e=t.sent,o=[],n=[],a=e,e&&!(e.length<1)){t.next=9;break}return this.setData({shopCarNum:0}),t.abrupt("return");case 9:a.forEach((function(t){t.skuStocks.forEach((function(e){t.skuList=t.skuList?t.skuList:[],t.skuList.push(e.id)}));var e=t.skuStocks.every((function(t){return 0===t.stock}));t.status=e?2:t.status,1===t.deleted&&(t.status=2),t.skuList=t.skuList?t.skuList:[],t.status=-1===t.skuList.indexOf(t.skuId)?0:t.status,t.activityEndTime&&(t.status="1"===t.activityStatus||"0"===t.activityStatus?1:0),1===t.status?o.push(t):n.push(t)})),r=o.reduce((function(t,e){return t+e.goodsNumber}),0),this.setData({shopCarNum:r});case 12:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"addFooterAdd",value:function(){var t=this.goodDetail;if(t.id){var e={originalPrice:t.price,productId:t.id,productName:t.name,productPic:t.pic,productPrice:t.actPrice,status:t.status};(0,c.userFooterAdd)(e)}}},{key:"handleSeePhoto",value:function(e){var o=e.currentTarget.dataset.item;t.previewImage({current:o.value,urls:[o.value]})}},{key:"getCollectType",value:function(t){var e=this;(0,c.checkIsCollect)({productId:t}).then((function(t){var o=e.goodDetail;o.isCollect=t,e.setData({goodDetail:o})}))}},{key:"addCollect",value:function(){var e=this,o=this.goodDetail,n={originalPrice:o.price,productId:o.id,productName:o.name,productPic:o.pic,productPrice:o.actPrice,status:o.status},i=[];i.push(n),o.isCollect?this.cancelCollect(n):(0,c.userAddCollect)(i).then((function(){t.showToast({title:"收藏成功",icon:"none"});var o=e.goodDetail;o.isCollect=!0,e.setData({goodDetail:Object.assign({},o)})})).catch((function(t){console.log(t)}))}},{key:"cancelCollect",value:function(e){var o=this;(0,c.userDelCollect)(e).then((function(){t.showToast({title:"取消成功",icon:"none"});var e=o.goodDetail;e.isCollect=!1,o.setData({goodDetail:Object.assign({},e)})}))}},{key:"authClick",value:function(){this.setData({authType:!1})}},{key:"cancel",value:function(t){this.setData({authType:t})}},{key:"submit",value:function(){var t=this.$STORE.userStore.userInfo;if(t.whetherAuthorization){var e=this.goodDetail,o={},n=e.skuStocks;this.getNorms.id?(o=e.skuStocks[0],o.pic=1===n.length?e.pic:e.skuStocks[0].pic,o.price="0.00"!==String(e.actPrice)?e.actPrice:e.price,this.getNorms.id&&(o=this.getNorms)):(o.pic=e.albumPics.split(",")[0],"0.00"!==String(e.actPrice)?o.price=e.actPrice?e.actPrice:e.price:o.price=e.price,o.maxNum=0===e.skuStocks[0].perLimit?e.skuStocks[0].stock:e.skuStocks[0].perLimit,o.id="",o.memPrice=e.memPrice),this.setData({norms:o,buyShow:!0})}else this.setData({authType:!0})}},{key:"hiddenCrad",value:function(){this.setData({cardFlag:!0})}},{key:"cardClick",value:function(){var e=this;t.canvasToTempFilePath({canvasId:"cardCanvas",success:function(o){e.setData({cardFlag:!0});var n=o.tempFilePath;t.previewImage({current:n,urls:[n]})}})}},{key:"savePhoto",value:function(){var e=this;t.getSetting({success:function(o){!1===o.authSetting["scope.writePhotosAlbum"]?t.showModal({title:"",content:"请在设置中开启保存相册功能后再次保存图片",success:function(){t.openSetting({})}}):t.saveImageToPhotosAlbum({filePath:e.cardImgUrl,success:function(){t.showToast({title:"保存成功",icon:"none"})}})}})}},{key:"shareBrCard",value:function(){var e=this,n=(o("7457"),"");this.showLoad(),t.pageScrollTo({scrollTop:0,duration:200}),this.setData({cardFlag:!1,shareVisible:!1});var i={},a=this.$STORE.userStore.userInfo.transData;a.goodData.launchArea=this.goodDetail.launchArea,a.goodData.id=this.goodDetail.id;var r="".concat(a.communityId," ").concat(a.groupType," ").concat(a.isGrouper," ").concat(this.$STORE.userStore.userInfo.shopUserId);i={path:"subcontract/pages/detail/detail?id=".concat(this.goodDetail.id,"&goodTranObj=").concat(r),width:0},(0,c.getImgCode)(i).then((function(o){n=o,(0,l.base64src)(n,(function(o){n=o,t.downloadFile({url:e.goodDetail.pic,success:function(t){d.default.methods.canvCard(e.goodDetail,0,t.tempFilePath,n).then((function(t){e.setData({cardImgUrl:t,showAll:!0}),e.showLoad()}))}})}))}))}},{key:"showLoad",value:function(){this.cardImgUrl?t.hideLoading():t.showLoading({title:"图片生成中"})}},{key:"preventTouchMove",value:function(){}},{key:"getShareData",value:function(){return{title:this.goodDetail.name,path:"/subcontract/pages/detail/detail?id=".concat(this.goodDetail.id),imageUrl:this.imgUrl}}},{key:"onShareAppMessage",value:function(){return this.getShareData()}}]),a}(r.Vue);U=(0,a.__decorate)([(0,r.Component)({components:{sign:_,canvasCom:F,selectNorms:A,mIcon:M,auth:L}})],U);var $=U;e.default=$}).call(this,o("543d")["default"])},c7b0:function(t,e,o){"use strict";o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return a})),o.d(e,"a",(function(){return n}));var n={mIcon:function(){return o.e("components/m-icon/m-icon").then(o.bind(null,"c7bc"))},sign:function(){return o.e("components/sign/sign").then(o.bind(null,"7e38"))},auth:function(){return o.e("components/auth/auth").then(o.bind(null,"f72f"))}},i=function(){var t=this,e=t.$createElement;t._self._c},a=[]},f4ae:function(t,e,o){"use strict";o.r(e);var n=o("c7b0"),i=o("fc51");for(var a in i)["default"].indexOf(a)<0&&function(t){o.d(e,t,(function(){return i[t]}))}(a);o("296f");var r,s=o("f0c5"),c=o("636d"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"4b123bd4",null,!1,n["a"],r);"function"===typeof c["a"]&&Object(c["a"])(u),e["default"]=u.exports},f97b:function(t,e,o){},fc51:function(t,e,o){"use strict";o.r(e);var n=o("902f"),i=o.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){o.d(e,t,(function(){return n[t]}))}(a);e["default"]=i.a}},[["174f","common/runtime","common/vendor"]]]);